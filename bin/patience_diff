#!/usr/bin/env ruby
require 'English'

lib_path = File.expand_path(File.join(File.dirname(__FILE__),"..","lib"))
$LOAD_PATH.unshift(lib_path)
require 'patience_diff'

debugging = true

begin
  raise PatienceDiff::UsageError unless ARGV.length == 2
  
  left_file, right_file = *ARGV
  
  left = File.read(left_file).split($RS)
  left_timestamp = File.mtime(left_file)
  right = File.read(right_file).split($RS)
  right_timestamp = File.mtime(right_file)
  
  formatter = PatienceDiff::TextFormat.new
  puts formatter.unified_diff(left, right, left_file, right_file, left_timestamp, right_timestamp)
  
rescue PatienceDiff::UsageError => e
  e.print_usage
rescue StandardError => e
  if debugging
    raise
  else
    $stderr.puts "Error: #{e}"
  end
end
