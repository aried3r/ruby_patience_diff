#!/usr/bin/env ruby

# frozen_string_literal: true

require 'pathname'
require 'trollop'

lib_path = Pathname(File.join(File.dirname(__FILE__), '..', 'lib')).realpath
$LOAD_PATH.unshift(lib_path)
require 'patience_diff'

program_name = File.basename($PROGRAM_NAME)
opts = Trollop.options do
  banner <<-EOF.gsub(/^\s*/, '')
    Usage: #{program_name} [options] left-file right-file (left-file-2 right-file-2 ...)
    Options:
  EOF

  version "#{program_name} #{PatienceDiff::VERSION}"

  opt :context, 'Lines of context', default: 3
  opt :all_context, "Don't collapse common sections; output entire files."
  opt :ignore_whitespace,
      <<~EOF.tr("\n", ' '),
        Ignore trailing whitespace, and treat leading whitespace as either present or not. This switch
        is for compatibility with diff's -b option.
      EOF
      short: '-b'
end

Trollop.educate($stderr) unless ARGV.length && ARGV.length.even?

differ = PatienceDiff::Differ.new(opts)

ARGV.each_slice(2) do |(left_file, right_file)|
  differ.diff_files(left_file, right_file)
end
